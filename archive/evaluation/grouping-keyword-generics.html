<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Grouping keyword generics - keyword generics initiative</title>
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="../../favicon.svg">
                        <link rel="shortcut icon" href="../../favicon.png">
                <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
                <link rel="stylesheet" href="../../css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="../../fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="../../index.html">üëã Welcome</a></li><li class="chapter-item "><a href="../../updates/index.html">‚úèÔ∏è Updates</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../updates/2022-07-27-announcing-the-keyword-generics-initiative.html">2022-07-27: Announcing the Keyword Generics Initiative</a></li><li class="chapter-item "><a href="../../updates/2023-02-23-keyword-generics-progress-report-feb-2023.html">2023-02-23: Keyword Generics Progress Report February 2023</a></li><li class="chapter-item "><a href="../../updates/2024-02-09-extending-rusts-effect-system.html">2024-02-09: Extending Rust's Effect System</a></li></ol></li><li class="chapter-item "><a href="../../CHARTER.html">üìú Charter</a></li><li class="chapter-item "><a href="../../evaluation/index.html">üî¨ Evaluation</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../evaluation/syntax/index.html">Syntax</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../evaluation/syntax/_template.html">Template</a></li><li class="chapter-item "><a href="../../evaluation/syntax/attributes.html">Attributes</a></li><li class="chapter-item "><a href="../../evaluation/syntax/const-bool-like-effects.html">Const-bool like effects</a></li><li class="chapter-item "><a href="../../evaluation/syntax/effect-as-a-clause.html">Effect as a clause</a></li><li class="chapter-item "><a href="../../evaluation/syntax/postfix-question-mark.html">Postfix question mark</a></li><li class="chapter-item "><a href="../../evaluation/syntax/where-effect-bounds.html">Where effect bounds</a></li></ol></li><li class="chapter-item "><a href="../../evaluation/pattern-types.html">Pattern Types and Backwards Compatibility</a></li><li class="chapter-item "><a href="../../evaluation/auto-concurrency.html">Auto Concurrency</a></li></ol></li><li class="chapter-item "><a href="../../explainer/index.html">üìö Draft RFCs</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../explainer/effect-generic-trait-declarations.html">Effect-Generic Trait Declarations</a></li><li class="chapter-item "><a href="../../explainer/effect-generic-bounds-and-functions.html">Effect-Generic Bounds and Functions</a></li><li class="chapter-item "><div>Effect-Generic Types</div></li><li class="chapter-item "><div>Effect Sets and Aliases</div></li></ol></li><li class="chapter-item expanded "><a href="../../archive/index.html">üì¶ Archive</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust.html">Effects in Rust</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/async.html">Asynchrony</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/const.html">Compile-Time Execution</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/try.html">Fallibility</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/gen.html">Iteration</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/panic.html">Unwinding</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/unsafe.html">Memory-Safety</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/pin.html">Immovability</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/sized.html">Object-Safety</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/ownership.html">Ownership</a></li><li class="chapter-item "><a href="../../archive/evaluation/effects-in-rust/send.html">Thread-Safety</a></li></ol></li><li class="chapter-item "><a href="../../archive/evaluation/effect-hierarchy.html">Effect hierarchy</a></li><li class="chapter-item expanded "><a href="../../archive/evaluation/grouping-keyword-generics.html" class="active">Grouping keyword generics</a></li><li class="chapter-item "><a href="../../archive/evaluation/introducing-new-keyword-generics.html">Introducing new keyword generics</a></li><li class="chapter-item "><a href="../../archive/evaluation/mir-desugaring.html">MIR desugaring</a></li><li class="chapter-item "><a href="../../archive/evaluation/overloading-keyword-generics.html">Overloading</a></li><li class="chapter-item "><a href="../../archive/evaluation/prior-art.html">Prior Art</a></li></ol></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">keyword generics initiative</h1>

                    <div class="right-buttons">
                                                <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        <a href="https://github.com/yoshuawuyts/keyword-generics-initiative" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                                                                        <a href="https://github.com/yoshuawuyts/keyword-generics-initiative/edit/master/./archive/evaluation/grouping-keyword-generics.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="grouping-keyword-generics"><a class="header" href="#grouping-keyword-generics">Grouping Keyword Generics</a></h1>
<p>We expect it to be common that if a function takes generics and has conditional
keywords on those, it will want to be conditional over <em>all</em> keywords on those
generics. So in order to not have people repeat params over and over, we should
provide shorthand syntax.</p>
<p>Here is the &quot;base&quot; variant we're changing:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// without any effects
fn find&lt;I&gt;(
    iter: impl Iterator&lt;Item = I&gt;,
    closure: impl FnMut(&amp;I) -&gt; bool,
) -&gt; Option&lt;I&gt; {
    ...    
}
<span class="boring">}
</span></code></pre></pre>
<p>We could imagine wanting a fallible variant of this which can short-circuit
based on whether an <code>Error</code> is returned or not. We could imagine the &quot;base&quot;
version using a <code>TryTrait</code> notation, and the &quot;effect&quot; version using the <code>throws</code>
keyword. Both variants would look something like this:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// fallible without effect notation
fn try_find&lt;I, E&gt;(
    iter: impl TryIterator&lt;Item = I, E&gt;,
    closure: impl TryFnMut&lt;(&amp;I), E&gt; -&gt; bool,
) -&gt; Result&lt;Option&lt;I&gt;, E&gt; {
    ...
}

// fallible with effect notation
fn try_find&lt;I, E&gt;(
    iter: impl Iterator&lt;Item = I&gt; ~yeets E,
    closure: impl FnMut(&amp;I) ~yeets E -&gt; bool,
) -&gt; Option&lt;I&gt; ~yeets E {
    ...
}
<span class="boring">}
</span></code></pre></pre>
<p>For <code>async</code> we could do something similar. The &quot;base&quot; version would use
<code>AsyncTrait</code> variants. And the &quot;effect&quot; variant would use the <code>async</code> keyword:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// async without effect notation
fn async_find&lt;I&gt;(
    iter: impl AsyncIterator&lt;Item = I&gt;,
    closure: impl AsyncFnMut(&amp;I) -&gt; bool,
) -&gt; impl Future&lt;Output = Option&lt;I&gt;&gt; {
    ...
}

// async with effect notation
~async fn async_find&lt;I&gt;(
    iter: impl ~async Iterator&lt;Item = I&gt;,
    closure: impl ~async FnMut(&amp;I) -&gt; bool,
) -&gt; Option&lt;I&gt; {
    ...
}
<span class="boring">}
</span></code></pre></pre>
<p>Both the &quot;fallible&quot; and &quot;async&quot; variants mirror each other closely. And it's
easy to imagine we'd want to be conditional over both. However, if neither the
&quot;base&quot; or the &quot;effect&quot; variants are particularly pleasant.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// async + fallible without effect notation
fn try_async_find&lt;I, E&gt;(
    iter: impl TryAsyncIterator&lt;Item = Result&lt;I, E&gt;&gt;,
    closure: impl TryAsyncFnMut&lt;(&amp;I), E&gt; -&gt; bool,
) -&gt; impl Future&lt;Output = Option&lt;Result&lt;I, E&gt;&gt;&gt; {
    ...
}

// async + fallible with effect notation
~async fn try async_find&lt;I, E&gt;(
    iter: impl ~async Iterator&lt;Item = I&gt; ~yeets E,
    closure: impl ~async FnMut(&amp;I) ~yeets E -&gt; bool,
) -&gt; Option&lt;I&gt; ~yeets E {
    ...
}
<span class="boring">}
</span></code></pre></pre>
<p>The &quot;base&quot; variant is entirely unworkable since it introduces a combinatorial
explosion of effects (&quot;fallible&quot; and &quot;async&quot; are only two examples of effects).
The &quot;effect&quot; variant is a little better because it composes, but even with just
two effects it looks utterly overwhelming. Can you imagine what it would look
like with three or four? Yikes.</p>
<p>So what if we could instead treat effects as an actual generic parameter? As we
discussed earlier, in order to lower effects we already need a new type of
generic at the MIR layer. But what if we exposed that type of generics as user
syntax too? We could imagine it to look something like this:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// conditional
fn any_find&lt;I, effect F&gt;(
    iter: impl F * Iterator&lt;Item = I&gt;,
    closure: impl F * FnMut(&amp;I) -&gt; bool,
) -&gt; F * Option&lt;I&gt; {
    ...    
}
<span class="boring">}
</span></code></pre></pre>
<p>There are legitimate questions here though. Effects which provide a superset of
base Rust may change the way we write Rust. The clearest example of this is
<code>async</code>: would having an <code>effect F</code> require that we when we invoke our <code>closure</code>
that we suffix it with <code>.await</code>? What about a <code>try</code> effect, would that require
that we suffix it with a <code>?</code> operator? The effects passed to the function might
need to change the way we author the function body <sup class="footnote-reference"><a href="#implication">1</a></sup>.</p>
<div class="footnote-definition" id="implication"><sup class="footnote-definition-label">1</sup>
<p>One interesting thing to keep in mind is that the total set of
effects is strictly <em>bounded</em>. None of these mechanisms would be exposed to
end-users to define their own effects, but only used by the Rust language. This
means we can know which effects are part of the set. And any change in calling
signature (e.g. adding <code>.await</code> or <code>?</code>, etc.) can be part of a Rust edition.</p>
</div>
<p>Another question is about <em>bounds</em>. Declaring an <code>effect F</code> is maximally
inclusive: it would capture all effects. Should we be able to place restrictions
on this effect, and if so what should that look like?</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                                                    <a rel="prev" href="../../archive/evaluation/effect-hierarchy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        
                                                    <a rel="next" href="../../archive/evaluation/introducing-new-keyword-generics.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                                    <a rel="prev" href="../../archive/evaluation/effect-hierarchy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                
                                    <a rel="next" href="../../archive/evaluation/introducing-new-keyword-generics.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
        
    </body>
</html>
